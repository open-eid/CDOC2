
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../.." rel="prev"/>
<link href="../../02_protocol_and_cryptography_spec/ch02_encryption_schemes/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.50" name="generator"/>
<title>3. Use Case Model - CDOC2 System Documentation</title>
<link href="../../assets/stylesheets/main.a40c8224.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#cdoc2-client-application-use-case-model">2. 
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="CDOC2 System Documentation" class="md-header__button md-logo" data-md-component="logo" href="../.." title="CDOC2 System Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            CDOC2 System Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              3. Use Case Model
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="CDOC2 System Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="CDOC2 System Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    CDOC2 System Documentation
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Introduction
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Use Case Model
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Use Case Model
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Use Cases
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Use Cases
  </span>
</a>
<nav aria-label="In this chapter:" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      In this chapter:
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#actors">
<span class="md-ellipsis">
      Actors
    </span>
</a>
<nav aria-label="Actors" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#human-actors">
<span class="md-ellipsis">
      Human actors
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-components-as-actors">
<span class="md-ellipsis">
      System components as actors
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases-for-recipients-with-hardware-security-tokens">
<span class="md-ellipsis">
      Use cases for Recipients with hardware security tokens
    </span>
</a>
<nav aria-label="Use cases for Recipients with hardware security tokens" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclient01-encrypt-cdoc2-container-for-sending-to-recipient-with-a-security-token">
<span class="md-ellipsis">
      UC.Client.01 — Encrypt CDOC2 container for sending to Recipient with a security token
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclient02-decrypt-cdoc2-container-with-a-security-token">
<span class="md-ellipsis">
      UC.Client.02 — Decrypt CDOC2 Container with a security token
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases-for-password-based-encryption">
<span class="md-ellipsis">
      Use cases for password-based encryption
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclientp01-encrypt-cdoc2-container-with-password-for-long-term-storage">
<span class="md-ellipsis">
      UC.Client.P.01 — Encrypt CDOC2 container with password for long-term storage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclientp02-decrypt-cdoc2-container-with-password">
<span class="md-ellipsis">
      UC.Client.P.02 — Decrypt CDOC2 container with password
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclientp04-re-encrypt-existing-cdoc2-container-for-long-term-storage">
<span class="md-ellipsis">
      UC.Client.P.04 — Re-encrypt existing CDOC2 container for long-term storage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases-supporting-recipients-authenticating-to-multiple-cdoc2-shares-servers">
<span class="md-ellipsis">
      Use cases supporting Recipients authenticating to multiple CDOC2 Shares Servers
    </span>
</a>
<nav aria-label="Use cases supporting Recipients authenticating to multiple CDOC2 Shares Servers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclient03-encrypt-cdoc2-container-using-key-shares">
<span class="md-ellipsis">
      UC.Client.03 — Encrypt CDOC2 container using key shares
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclient04-decrypt-cdoc2-container-using-multiserver-authentication">
<span class="md-ellipsis">
      UC.Client.04 — Decrypt CDOC2 container using multiserver authentication
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Protocol and Cryptography Specification
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Protocol and Cryptography Specification
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../02_protocol_and_cryptography_spec/ch02_encryption_schemes/">
<span class="md-ellipsis">
    Encryption Schemes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02_protocol_and_cryptography_spec/ch03_container_format/">
<span class="md-ellipsis">
    Container Format
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02_protocol_and_cryptography_spec/ch05_cryptographic_details/">
<span class="md-ellipsis">
    Cryptographic Details
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02_protocol_and_cryptography_spec/appendix_a_header_fbs/">
<span class="md-ellipsis">
    Appendix A: header.fbs
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02_protocol_and_cryptography_spec/appendix_b_recipients_fbs/">
<span class="md-ellipsis">
    Appendix B: recipients.fbs
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02_protocol_and_cryptography_spec/appendix_c_cdoc2-capsules/">
<span class="md-ellipsis">
    Appendix C: Capsules API
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02_protocol_and_cryptography_spec/appendix_d_keylabel/">
<span class="md-ellipsis">
    Appendix D: KeyLabel field specification
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02_protocol_and_cryptography_spec/appendix_e_cdoc2-shares/">
<span class="md-ellipsis">
    Appendix E: Key Shares API
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    System Architecture
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            System Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../03_system_architecture/ch01_system_context/">
<span class="md-ellipsis">
    System Context
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03_system_architecture/ch02_system_components/">
<span class="md-ellipsis">
    System Components
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03_system_architecture/ch03_external_interfaces/">
<span class="md-ellipsis">
    External Interfaces
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03_system_architecture/ch04_capsule_server/">
<span class="md-ellipsis">
    Capsule Server
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03_system_architecture/ch05_shares_server/">
<span class="md-ellipsis">
    Shares Server
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03_system_architecture/ch06_ID_authentication_protocol/">
<span class="md-ellipsis">
    Client authentication protocol
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Test Plan
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Test Plan
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../04_test_plan/test_plan/">
<span class="md-ellipsis">
    Capsule Server Test Plan
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    User Guides
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            User Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../08_User_Guides/password_guide/">
<span class="md-ellipsis">
    Password Strength User Guide
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../08_User_Guides/parooli_juhend/">
<span class="md-ellipsis">
    Parooli juhend
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../08_User_Guides/container_storage_guide/">
<span class="md-ellipsis">
    CDOC2 Container Storage User Guide
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../08_User_Guides/konteineri_s%C3%A4ilitamise_juhend/">
<span class="md-ellipsis">
    CDOC2 konteineri säilitamise juhend
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../08_User_Guides/overview_diagrams/">
<span class="md-ellipsis">
    Overview diagrams
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Appendixes
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Appendixes
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../09_Appendixes/A1_Security_level/">
<span class="md-ellipsis">
    Appendix 1: Security level
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="In this chapter:" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      In this chapter:
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#actors">
<span class="md-ellipsis">
      Actors
    </span>
</a>
<nav aria-label="Actors" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#human-actors">
<span class="md-ellipsis">
      Human actors
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-components-as-actors">
<span class="md-ellipsis">
      System components as actors
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases-for-recipients-with-hardware-security-tokens">
<span class="md-ellipsis">
      Use cases for Recipients with hardware security tokens
    </span>
</a>
<nav aria-label="Use cases for Recipients with hardware security tokens" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclient01-encrypt-cdoc2-container-for-sending-to-recipient-with-a-security-token">
<span class="md-ellipsis">
      UC.Client.01 — Encrypt CDOC2 container for sending to Recipient with a security token
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclient02-decrypt-cdoc2-container-with-a-security-token">
<span class="md-ellipsis">
      UC.Client.02 — Decrypt CDOC2 Container with a security token
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases-for-password-based-encryption">
<span class="md-ellipsis">
      Use cases for password-based encryption
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclientp01-encrypt-cdoc2-container-with-password-for-long-term-storage">
<span class="md-ellipsis">
      UC.Client.P.01 — Encrypt CDOC2 container with password for long-term storage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclientp02-decrypt-cdoc2-container-with-password">
<span class="md-ellipsis">
      UC.Client.P.02 — Decrypt CDOC2 container with password
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclientp04-re-encrypt-existing-cdoc2-container-for-long-term-storage">
<span class="md-ellipsis">
      UC.Client.P.04 — Re-encrypt existing CDOC2 container for long-term storage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases-supporting-recipients-authenticating-to-multiple-cdoc2-shares-servers">
<span class="md-ellipsis">
      Use cases supporting Recipients authenticating to multiple CDOC2 Shares Servers
    </span>
</a>
<nav aria-label="Use cases supporting Recipients authenticating to multiple CDOC2 Shares Servers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclient03-encrypt-cdoc2-container-using-key-shares">
<span class="md-ellipsis">
      UC.Client.03 — Encrypt CDOC2 container using key shares
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ucclient04-decrypt-cdoc2-container-using-multiserver-authentication">
<span class="md-ellipsis">
      UC.Client.04 — Decrypt CDOC2 container using multiserver authentication
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="cdoc2-client-application-use-case-model"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.</span> CDOC2 Client Application Use Case Model<a class="headerlink" href="#cdoc2-client-application-use-case-model" title="Permanent link">¶</a></h1>
<p>CDOC2 Client Application is an abstract component in the CDOC2 System. CDOC2 Client Applications help users to encrypt files to CDOC2 Container, decrypt received CDOC2 Containers. Specific examples of CDOC2 Client Applications include:</p>
<ul>
<li>DigiDoc4 desktop application for Windows, MacOS and Linux operating systems (<a href="https://open-eid.github.io/#desktop-applications">https://open-eid.github.io/#desktop-applications</a>, <a href="https://www.id.ee/en/rubriik/digidoc4-client/">https://www.id.ee/en/rubriik/digidoc4-client/</a>, <a href="https://github.com/open-eid/DigiDoc4-Client">https://github.com/open-eid/DigiDoc4-Client</a>)</li>
<li>DigiDoc4 mobile application for Android and IOS operating systems (<a href="https://open-eid.github.io/#mobile-applications">https://open-eid.github.io/#mobile-applications</a>)</li>
<li>CDOC2 Client CLI Application</li>
</ul>
<p>Use cases specified here are written in a generic form, so that they are applicable to all client applications. Client applications will implement specified use cases and their documentation may include additional information (use case models, UX wireframes, ...) about the implemented functions.
Use cases specified here are written in a generic form, so that they are applicable to all client applications. Client applications will implement specified use cases and their documentation may include additional information (use case models, UX wireframes, ...) about the implemented functions.</p>
<h2 id="actors"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.1</span> Actors<a class="headerlink" href="#actors" title="Permanent link">¶</a></h2>
<h3 id="human-actors"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.1.1</span> Human actors<a class="headerlink" href="#human-actors" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>User</strong></dt>
<dd>Person, who is using CDOC2 Client Applications for sending encrypted files to somebody else (then as a Sender), or decrypting received CDOC2 Containers (then as a Recipient). In some use cases, the User may encrypt files with symmetric encryption key or password, store the CDOC2 Container for themselves and later decrypt the CDOC2 Container by themselves.</dd>
<dt><strong>Sender</strong></dt>
<dd>User, who wishes to send encrypted files, which are packaged into a CDOC2 Container, to one or multiple Recipients</dd>
<dt><strong>Recipient</strong></dt>
<dd>User, who wishes to decrypt the received CDOC2 Container and has control over necessary cryptographic key material</dd>
<dt><strong>Administrator</strong></dt>
<dd>Person, who is managing CDOC2 Client Application for Users and is creating the configuration data for them</dd>
</dl>
<h3 id="system-components-as-actors"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.1.2</span> System components as actors<a class="headerlink" href="#system-components-as-actors" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>CDOC2 Client Application (Client)</strong></dt>
<dd>Desktop or mobile application, which encrypts or decrypts CDOC2 Containers and is used by Users</dd>
<dt><strong>CDOC2 Capsule Server (CCS)</strong></dt>
<dd>CCS mediates CDOC2 Server Capsules between Sender and Recipient. Sender's Client can upload a Server Capsule to one or multiple CCS servers. Recipient's Client can download Server Capsule from CCS server after authentication.</dd>
<dt><strong>CDOC2 Shares Server (CSS)</strong></dt>
<dd>CDOC2 Shares Server mediates Key Shares between Sender and Recipient. Sender's Client splits Shares Capsule into multiple Key Shares and each Key Share is uploaded into a single Shares Server. Recipient's Client can download Key Shares from Shares Servers after authentication.</dd>
<dt><strong>Capsule</strong></dt>
<dd>Data structure, which contains encryption scheme-specific information (encrypted symmetric keys, public keys, salt, server object references, ...)<br/>which Recipient can use to derive, establish or retrieve decryption keys for decrypting the CDOC2 Container. Capsule can either be a Server Capsule or a Container Capsule.</dd>
<dt><strong>Server Capsule</strong></dt>
<dd>A Capsule that is mediated by a CDOC2 Capsule Server.</dd>
<dt><strong>Container Capsule</strong></dt>
<dd>A Capsule that is created inside a CDOC2 container and is therefore not sent to a CDOC2 Capsule Server.</dd>
<dt><strong>Shares Capsule</strong></dt>
<dd>A capsule that stores all Key Shares of a Recipient record.</dd>
<dt><strong>Key Share</strong></dt>
<dd>Key Shares are created by splitting cryptographic material required for encrypting/decrypting CDOC2 document. These are stored inside Shares Capsules. Key Shares are always distributed among different Shares Servers and depending on the encryption scheme, all or a certain number of shares are needed to construct the original key value.</dd>
<dt><strong>LDAP-server</strong></dt>
<dd>An application used for publishing public keys.</dd>
</dl>
<h2 id="use-cases-for-recipients-with-hardware-security-tokens"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.2</span> Use cases for Recipients with hardware security tokens<a class="headerlink" href="#use-cases-for-recipients-with-hardware-security-tokens" title="Permanent link">¶</a></h2>
<p>These use cases are useful, when Sender knows that Recipient has specific hardware security token, and knows the public key certificate which correspond to the asymmetric cryptographic key pair on that security token. CC, which can be decrypted only with Recipient's security token, may be transmitted alongside with the CDOC2 Container itself with the encrypted payload, or with the help of CCS server.</p>
<h3 id="ucclient01-encrypt-cdoc2-container-for-sending-to-recipient-with-a-security-token"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.2.1</span> UC.Client.01 — Encrypt CDOC2 container for sending to Recipient with a security token<a class="headerlink" href="#ucclient01-encrypt-cdoc2-container-for-sending-to-recipient-with-a-security-token" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Use Case Context</strong></dt>
<dd>CDOC2 Client Application adds Sender's chosen files into the CDOC2 container and encrypts the container with CEK. CEK is encrypted with KEK, which is generated with key-agreement protocol between Sender and Recipient.</dd>
<dt><strong>Scope</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>Sender</dd>
<dt><strong>Preconditions</strong></dt>
<dd>Client has a long-term access token from CDOC2 authentication server.</dd>
</dl>
<p><strong>Success Guarantees</strong></p>
<ul>
<li>CDOC2 container is saved into file system.</li>
<li>A server capsule is sent for each Recipient to the CDOC2 capsule server.</li>
<li>Client has received a transaction code for each server capsule.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Sender chooses files to be included in CDOC2 container and specifies the target filename and path for CDOC2 container.</li>
<li>Sender enters identifiers for each Recipient.</li>
<li>Client creates a capsule for each Recipient.</li>
<li>Client displays a list of Capsule Servers to Sender.</li>
<li>Sender chooses a CDOC2 Capsule Server.</li>
<li>Client creates a TLS-connection with the chosen CDOC2 Capsule Server and receives the server's certificate.</li>
<li>Client verifies the server's certificate against the configuration.</li>
<li>Client forwards each Recipient's server capsule to the chosen CDOC2 Capsule Server. Client provides a server capsule expiration time from internal application configuration for each capsule. If a Recipient's certificate expiration time is earlier, it uses the certificate expiration time for that Recipient's capsule. Client receives a transaction code for each server capsule.</li>
<li>Client creates a container into file system in the chosen target path and adds a header.</li>
<li>Client verifies that the header does not exceed the size limit defined by the specification.</li>
<li>Client verifies technical file correctness and file name safety rules according to the specification. Client creates an archive, compresses it, encrypts the compressed archive with CEK and adds it to the container as payload.</li>
<li>Client saves the CDOC2 container and displays Sender a notification.</li>
</ol>
<p><strong>Extensions</strong></p>
<p>1a. Sender chose to encrypt from the Windows Explorer / MacOS Finder / Linux folder explorer context dialog: "Encrypt with eID" and "Encrypt with password":</p>
<ol>
<li>Client asks Sender for the container target name and path.</li>
<li>Sender specifies the target name and path.</li>
<li>Use case continues from step 2.</li>
</ol>
<p>2a. Client chooses to search for Recipient information in LDAP directory:</p>
<ol>
<li>Sender inserts Recipient personal code.</li>
<li>Client requests corresponding certificates and displays those.</li>
<li>Sender chooses certificate(s).</li>
<li>Use case continues from step 2.</li>
</ol>
<p>2b. Certificate is not readable or is not in proper format:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>5a. Configuration has no CDOC2 capsule servers:</p>
<ol>
<li>Client creates a container in the target path and adds a header with container capsules for each recipient.</li>
<li>Use case continues from step 11.</li>
</ol>
<p>5b. Configuration has a default CDOC2 capsule server:</p>
<ol>
<li>Use case continues from step 7.</li>
</ol>
<p>6a. Sender chooses to not use the CDOC2 capsule server:</p>
<ol>
<li>Client creates a container in the target path and adds a header with container capsules for each recipient.</li>
<li>Use case continues from step 11.</li>
</ol>
<p>7a. TLS connection cannot be established:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case continues from step 5.</li>
</ol>
<p>8a. Certificate validation against the configuration fails:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case continues from step 5.</li>
</ol>
<p>8b. Client uses an organization-specific external configuration service:</p>
<ol>
<li>Client first syncs default capsule expiration time from an organization-specific external service.</li>
<li>External configuration service provides a default capsule expiration time.</li>
<li>Client sends a server capsule using the appropriate API service to a CCS using the expiration time from external configuration or when a Recipient's certificate expiration time is earlier, it uses the certificate expiration time for that Recipient's capsule. Client receives a transaction code for each server capsule.</li>
<li>Use case continues from step 9.</li>
</ol>
<p>8c. The expiration time provided by Client is longer than allowed in the CCS system configuration:</p>
<ol>
<li>CCS returns Client an error message.</li>
<li>Client notifies Sender.</li>
<li>Use case ends.</li>
</ol>
<p>9a. Forwarding capsules to a CDOC2 capsule server fails:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>9b. CDOC2 capsule server does not return a transaction identifier for each server capsule:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>10a. Header size is larger than allowed by the specification:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>11a. Files are not correct:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<h3 id="ucclient02-decrypt-cdoc2-container-with-a-security-token"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.2.2</span> UC.Client.02 — Decrypt CDOC2 Container with a security token<a class="headerlink" href="#ucclient02-decrypt-cdoc2-container-with-a-security-token" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Use Case Context</strong></dt>
<dd>CDOC2 Client Application (Client) decrypts the archive in the CDOC2 container provided by Recipient, using a server capsule from either CDOC2 Capsule Server or a container capsule from inside the container.</dd>
</dl>
<p><strong>Scope</strong>
CDOC2 Client Application</p>
<dl>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>Recipient</dd>
</dl>
<p><strong>Preconditions</strong></p>
<ul>
<li>Recipient's security token is connected.</li>
<li>Client has a long-term access token from CDOC2 authentication server.</li>
</ul>
<p><strong>Success Guarantees</strong></p>
<ul>
<li>Files from the CDOC2 container are decrypted.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Recipient chooses the CDOC2 Container to be decrypted and specifies the target filename and path for the files.</li>
<li>Client verifies that the header does not exceed the size limit defined by the specification.</li>
<li>Client reads Recipient certificate from the security token.</li>
<li>Client verifies that the container has a record of the Recipient.</li>
<li>Client verifies that the Recipient record has a CDOC2 Capsule Server reference.</li>
<li>Client uses Recipient's eID means to authenticate to CCS.</li>
<li>Client sends the CDOC2 Capsule Server the transaction code from the container.</li>
<li>Client receives a capsule from the CDOC2 Capsule Server.</li>
<li>Client decrypts the encrypted archive in the CDOC2 container using the connected security token.</li>
<li>Continues with UC.Client.P.04 — Re-encrypt existing CDOC2 container for long-term storage.</li>
</ol>
<p><strong>Extensions</strong>
2a. Header size is larger than allowed by the specification:</p>
<ol>
<li>Client displays Recipient a notification.</li>
<li>Use case ends.</li>
</ol>
<p>3a. Reading certificate from the security token fails.</p>
<ol>
<li>Client displays Recipient a notification.</li>
<li>Use case ends.</li>
</ol>
<p>4a. Recipient record not found in the container.</p>
<ol>
<li>Client displays Recipient a notification.</li>
<li>Use case ends.</li>
</ol>
<p>5a. Recipient record does not contain a reference to a CDOC2 Capsule Server.</p>
<ol>
<li>Client finds a container capsule from the Recipient record.</li>
<li>Use case continues from step 9.</li>
</ol>
<p>6a. PIN 1 code is required:</p>
<ol>
<li>Client asks user for a PIN 1 code.</li>
<li>Recipient enters the PIN code.</li>
<li>Client completes the authentication. Use case continues from step 7.</li>
</ol>
<p>6b. Authentication fails:</p>
<ol>
<li>Client displays user a notification.</li>
<li>Use case ends.</li>
</ol>
<p>8a. No capsule returned from CDOC2 Capsule Server:</p>
<ol>
<li>Client displays user a notification.</li>
<li>Use case ends.</li>
</ol>
<p>9a. Decryption of the content encryption key fails:</p>
<ol>
<li>Client displays user a notification.</li>
<li>Use case ends.</li>
</ol>
<h2 id="use-cases-for-password-based-encryption"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.3</span> Use cases for password-based encryption<a class="headerlink" href="#use-cases-for-password-based-encryption" title="Permanent link">¶</a></h2>
<p>These use cases are useful when User wishes to protect confidential files by encrypting them with CEK generated from regular password. User may then store CDOC2 Container for longer period, without worrying that security token may not be usable, or public key certificate might be revoked or expired. CDOC2 Container may be later decrypted by Sender itself or Recipient, who knows the shared password.</p>
<p>This group of UCs also include a special use case, when Recipient re-encrypts the content from received Container with a password.</p>
<h2 id="ucclientp01-encrypt-cdoc2-container-with-password-for-long-term-storage"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.4</span> UC.Client.P.01 — Encrypt CDOC2 container with password for long-term storage<a class="headerlink" href="#ucclientp01-encrypt-cdoc2-container-with-password-for-long-term-storage" title="Permanent link">¶</a></h2>
<dl>
<dt><strong>Use Case Context</strong></dt>
<dd>Encrypt local files for long-term storage using CDOC2 Client Application and password-based cryptography by creating a new CDOC2 Container. This use case is useful for occasions where decryption does not depend on availability of security tokens.</dd>
<dt><strong>Scope</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>User</dd>
</dl>
<p><strong>Success Guarantees</strong></p>
<ul>
<li>A new CDOC2 container is created and it can be decrypted with the user's password.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>User chooses the files that are to be encrypted.</li>
<li>Client asks User to specify the target name and path.</li>
<li>User specifies a target name and path in local file system.</li>
<li>User enters a password to be used for password-based cryptography and a password hint (short one-line text) to be displayed during decryption.</li>
<li>Client verifies that the password satisfies minimal requirements.</li>
<li>Client creates a container into file system in the chosen target path and adds a header.</li>
<li>Client verifies that the header does not exceed the size limit defined by the specification.</li>
<li>Client verifies technical file correctness, creates an archive, compresses it and encrypts the compressed archive.</li>
<li>Client saves the CDOC2 container and displays Sender a notification.</li>
</ol>
<p><strong>Extensions</strong></p>
<p>1a. Sender chose to encrypt from the Windows Explorer / MacOS Finder / Linux folder explorer context dialog: "Encrypt with eID" and "Encrypt with password":</p>
<ol>
<li>Client asks Sender for the container target name and path.</li>
<li>Sender specifies the target name and path.</li>
<li>Use case continues from step 2.</li>
</ol>
<p>5a. Password does not meet minimum requirements:</p>
<ol>
<li>Client notifies the User with instructions to insert a new password.</li>
<li>Use case continues from step 4.</li>
</ol>
<p>6a. Container creation fails:</p>
<ol>
<li>System notifies the User.</li>
<li>Use case ends.</li>
</ol>
<p>7a. Header size is larger than allowed by the specification:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>8a. Files are not correct:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>9a. Container saving fails:</p>
<ol>
<li>Client notifies the User.</li>
<li>Use case ends.</li>
</ol>
<h2 id="ucclientp02-decrypt-cdoc2-container-with-password"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.5</span> UC.Client.P.02 — Decrypt CDOC2 container with password<a class="headerlink" href="#ucclientp02-decrypt-cdoc2-container-with-password" title="Permanent link">¶</a></h2>
<dl>
<dt><strong>Use Case Context</strong></dt>
<dd>CDOC2 Client Application decrypts CDOC2 Container with password-based cryptography.</dd>
<dt><strong>Scope</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>User, Recipient</dd>
</dl>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>User specifies which CDOC2 container they wish to open.</li>
<li>Client opens the container and retrieves the header information. Client verifies that the header does not exceed the limit defined in the specification.</li>
<li>Client asks User for the password to decrypt the container. Client shows a password hint based on the <code>KeyLabel</code> value set during encryption.</li>
<li>User enters the password.</li>
<li>Client verifies the password and decrypts the CDOC2 container.</li>
<li>Client asks user for the target location where to save the files.</li>
<li>User defines the target location.</li>
<li>Client unpacks the archive contents and saves it to the target location.</li>
</ol>
<p><strong>Extensions</strong></p>
<p>2a. Header exceed the length limit according to the specification:</p>
<ol>
<li>Client notifies the user.</li>
<li>Use case ends.</li>
</ol>
<p>5a. Password is not correct:</p>
<ol>
<li>Client notifies the user.</li>
<li>Use case continues from step 3.</li>
</ol>
<p>8a. Saving archive contents to disk fails:</p>
<ol>
<li>Client notifies the user.</li>
<li>Use case ends.</li>
</ol>
<h2 id="ucclientp04-re-encrypt-existing-cdoc2-container-for-long-term-storage"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.6</span> UC.Client.P.04 — Re-encrypt existing CDOC2 container for long-term storage<a class="headerlink" href="#ucclientp04-re-encrypt-existing-cdoc2-container-for-long-term-storage" title="Permanent link">¶</a></h2>
<dl>
<dt><strong>Use Case Context</strong></dt>
<dd>CDOC2 Client Application offers Recipient to re-encrypt all files after CDOC2 container decryption and before extracting and saving files locally.</dd>
<dt><strong>Scope</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>User, in a Recipient role</dd>
</dl>
<p><strong>Preconditions</strong></p>
<ul>
<li>CDOC2 container was just decrypted.</li>
</ul>
<p><strong>Success Guarantees</strong></p>
<ul>
<li>Files are re-encrypted.</li>
<li>The re-encrypted container is saved locally.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Client suggests Recipient to re-encrypt the decrypted container contents and displays multiple options for encryption.</li>
<li>Recipient chooses to re-encrypt and chooses to encrypt with a password.</li>
<li>Client asks Recipient to specify the target name and path.</li>
<li>Recipient specifies a target name and path in local file system.</li>
<li>Recipient enters a password to be used for password-based cryptography.</li>
<li>Client verifies that the password satisfies minimal requirements.</li>
<li>Client adds the files to an archive and creates a new CDOC2 container, which it saves to the target location.</li>
<li>Client notifies the Recipient.</li>
</ol>
<p><strong>Extensions</strong></p>
<p>2a. Recipient chooses to re-encrypt using a security token:</p>
<ol>
<li>Client verifies that the security token is connected.</li>
<li>Recipient specifies a target name and path in local file system and enters the security token password.</li>
<li>Client verifies the password. If password is not correct, the use case continues from the previous step.</li>
<li>Use case continues from step 7.</li>
</ol>
<p>5a. Password does not meet minimum requirements.</p>
<ol>
<li>Client notifies the Recipient with instructions to insert a new password.</li>
<li>Use case continues from step 3.</li>
</ol>
<p>7a. Container creation or saving fails.</p>
<ol>
<li>System notifies the Recipient.</li>
<li>Use case ends.</li>
</ol>
<h2 id="use-cases-supporting-recipients-authenticating-to-multiple-cdoc2-shares-servers"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.7</span> Use cases supporting Recipients authenticating to multiple CDOC2 Shares Servers<a class="headerlink" href="#use-cases-supporting-recipients-authenticating-to-multiple-cdoc2-shares-servers" title="Permanent link">¶</a></h2>
<p>These use cases are useful, when Sender knows that Recipient can use eID means that support authentication. These allow Sender to divide the key material into shares according to a <a href="https://en.wikipedia.org/wiki/Secret_sharing">secret-sharing scheme</a> and distribute those among multiple independent CDOC2 Shares Servers (CSS). Recipient would need to authenticate to CSS servers and download all the shares in order to reconstruct the KEK from those.</p>
<h3 id="ucclient03-encrypt-cdoc2-container-using-key-shares"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.7.1</span> UC.Client.03 — Encrypt CDOC2 container using key shares<a class="headerlink" href="#ucclient03-encrypt-cdoc2-container-using-key-shares" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Use Case Context</strong></dt>
<dd>CDOC2 Client Application adds Sender's chosen files into the CDOC2 container and encrypts the container with CEK. CEK is encrypted with KEK. KEK is generated by Sender's Client and then divided into Key Shares. Each share is uploaded to different CDOC2 Shares Server.</dd>
<dt><strong>Scope</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>Sender</dd>
</dl>
<p><strong>Success Guarantees</strong></p>
<ul>
<li>CDOC2 container is saved into file system.</li>
<li>For each server capsule a share is sent to each CDOC2 Shares Server.</li>
<li>Client has received a share identifier for each Key Share.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Sender chooses files to be included in CDOC2 container and specifies the target filename and path for CDOC2 container.</li>
<li>Sender enters identifiers for each Recipient.</li>
<li>Client creates a capsule for each Recipient.</li>
<li>Client splits the capsules by creating a share for each CSS.</li>
<li>Client creates a TLS-connection with each CSS and receives the server certificates.</li>
<li>Client verifies the server certificates against the configuration.</li>
<li>Client forwards a share per Recipient together with their natural person identifier to each of the CDOC2 Shares Servers. Client receives a share identifier for each Key Share.</li>
<li>Client creates a container into file system in the chosen target path and adds a header.</li>
<li>Client verifies that the header does not exceed the size limit defined by the specification.</li>
<li>Client verifies technical file correctness and file name safety rules according to the specification. Client creates an archive, compresses it, encrypts the compressed archive with CEK and adds it to the container as payload.</li>
<li>Client saves the CDOC2 container and displays Sender a notification.</li>
</ol>
<p><strong>Extensions</strong></p>
<p>1a. Sender chose to encrypt from the Windows Explorer / MacOS Finder / Linux folder explorer context dialog: "Encrypt with eID":</p>
<ol>
<li>Client asks Sender for the container target name and path.</li>
<li>Sender specifies the target name and path.</li>
<li>Use case continues from step 2.</li>
</ol>
<p>5a. TLS connection cannot be established:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>6a. Certificate validation against the configuration fails:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>6b. Client uses an organization-specific external configuration service:</p>
<ol>
<li>Client first syncs default capsule expiration time from an organization-specific external service.</li>
<li>External configuration service provides a default capsule expiration time.</li>
<li>Client sends a Key Share to CSS API service using the expiration time from external configuration. Client receives a share identifier for each Key Share.</li>
<li>Use case continues from step 9.</li>
</ol>
<p>6c. The expiration time provided by Client is longer than allowed in the CSS system configuration:</p>
<ol>
<li>CSS returns Client an error message.</li>
<li>Client notifies Sender.</li>
<li>Use case ends.</li>
</ol>
<p>7a. Sending capsules to a CDOC2 Shares Server fails:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>7b. CDOC2 Shares Server does not return a share identifier for each Key Share:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>8a. Header size is larger than allowed by the specification:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<p>9a. Files are not correct:</p>
<ol>
<li>Client displays Sender a notification.</li>
<li>Use case ends.</li>
</ol>
<h3 id="ucclient04-decrypt-cdoc2-container-using-multiserver-authentication"><span class="enumerate-headings-plugin enumerate-heading-plugin">2.7.2</span> UC.Client.04 — Decrypt CDOC2 container using multiserver authentication<a class="headerlink" href="#ucclient04-decrypt-cdoc2-container-using-multiserver-authentication" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Use Case Context</strong></dt>
<dd>CDOC2 Client Application (Client) decrypts the archive in the CDOC2 container provided by Recipient, using the key material constructed from Key Shares obtained from multiple CDOC2 Shares Servers.</dd>
</dl>
<p><strong>Scope</strong>
CDOC2 Client Application</p>
<dl>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>Recipient</dd>
</dl>
<p><strong>Preconditions</strong></p>
<ul>
<li>The CDOC2 container has been encrypted using Key Shares and supports authentication-based decryption.</li>
</ul>
<p><strong>Success Guarantees</strong></p>
<ul>
<li>Files from the CDOC2 container are decrypted.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Recipient chooses the CDOC2 Container to be decrypted and specifies the target filename and path for the files.</li>
<li>Client verifies that the header does not exceed the size limit defined by the specification.</li>
<li>Recipient enters their personal identification number and chooses an eID authentication method.</li>
<li>Client finds Capsule Share matching to recipient identification number. Client reads share identifiers and their matching Shares Server URLs from Capsule Share and requests a nonce for each share identifier.</li>
<li>Client uses share identifier, Share Server URL and the nonce of each Key Share to generate an AuthenticationToken.</li>
<li>Client shows Recipient an authentication form with input options specific to the authentication service (e.g., phone number input field, QR code scanning option). The Recipient initiates authentication using one of the options.</li>
<li>Client initiates AuthenticationToken signing with authentication service.</li>
<li>Recipient completes the authentication using their eID means which also creates a signature on the authentication hash with authentication key pair.</li>
<li>Client reads Recipient certificate from the authentication response.</li>
<li>Client verifies that the container has a Recipient record with the same Recipient ID.</li>
<li>Client constructs a Share specific authentication ticket and uses it to authenticate itself to download the data of a Key Share.</li>
<li>Client receives data for all Key Shares.</li>
<li>Client combines the shares into a full secret and derives the KEK. Client uses the key material to decrypt the encrypted archive in the CDOC2 container and calculate HMAC to validate the integrity of the container.</li>
<li>Continues with UC.Client.P.04 — Re-encrypt existing CDOC2 container for long-term storage.</li>
</ol>
<p><strong>Extensions</strong>
2a. Header size is larger than allowed by the specification:</p>
<ol>
<li>Client displays Recipient a notification.</li>
<li>Use case ends.</li>
</ol>
<p>8a. Authentication is not successful:</p>
<ol>
<li>Client notifies the user and offers to try again.</li>
<li>Use case continues from step 6.</li>
</ol>
<p>10a. A Recipient record does not exist with the same personal identification number:</p>
<ol>
<li>Client displays Recipient a notification.</li>
<li>Use case ends.</li>
</ol>
<p>11a. Authentication validation fails:</p>
<ol>
<li>Client displays Recipient a notification.</li>
<li>Use case ends.</li>
</ol>
<p>12a. Client does not receive shares from each CSS because a request timed out:</p>
<ol>
<li>Client displays user a notification and instructs trying again.</li>
<li>Use case continues from step 3.</li>
</ol>
<p>12a. Client does not receive shares from each CSS because a share is missing or expired:</p>
<ol>
<li>Client displays user a notification that the container cannot be decrypted anymore.</li>
<li>Use case ends.</li>
</ol>
<p>13a. Decryption or HMAC validation fails:</p>
<ol>
<li>Client displays user a notification that the container is corrupted.</li>
<li>Use case ends.</li>
</ol>
<h1 id="cdoc2-server-use-case-model"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.</span> CDOC2 Server Use Case Model<a class="headerlink" href="#cdoc2-server-use-case-model" title="Permanent link">¶</a></h1>
<h2 id="use-cases-where-cdoc2-capsule-servers-hold-the-whole-server-capsule"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.1</span> Use cases where CDOC2 Capsule Servers hold the whole Server Capsule<a class="headerlink" href="#use-cases-where-cdoc2-capsule-servers-hold-the-whole-server-capsule" title="Permanent link">¶</a></h2>
<p>These use cases are useful, when Sender knows that Recipient has specific hardware security token, and knows the public key certificate which correspond to the asymmetric cryptographic key pair on that security token. Server Capsule, which can be decrypted only with Recipient's security token, is stored on a single CCS server and must be accessed from there. CCS server enables expiration of access to these capsules.</p>
<h3 id="uckts01-forward-capsules"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.1.1</span> UC.KTS.01 Forward Capsules<a class="headerlink" href="#uckts01-forward-capsules" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Context of Use</strong></dt>
<dd>CDOC2 Client Application forwards Server Capsules to CDOC2 Capsule Server (CCS). Server Capsules contain a content encryption key encrypted for a particular Recipient, which is used for decrypting the archive in a CDOC2 container. Server Capsule is saved with an expiration time and a unique transaction ID is created and returned to the CDOC2 Client Application.</dd>
</dl>
<p><strong>Scope</strong>
CDOC2 Capsule Server (CCS)</p>
<dl>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
</dl>
<p><strong>Success Guarantees</strong></p>
<ul>
<li>Server Capsules are saved with an expiration time.</li>
<li>Transaction identifiers are forwarded to the CDOC2 Client Application.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Client sends a server capsule using the appropriate API service to a CCS. Client provides a server capsule expiration time from internal application configuration for each capsule. If a Recipient's certificate expiration time is earlier, it uses the certificate expiration time for that Recipient's capsule.</li>
<li>CCS validates the server capsules against specification rules.</li>
<li>CCS generates a universally unique transaction identifier (UUID).</li>
<li>CCS saves the server capsule, validates the expiration time provided by Client based on its system configuration settings and sets the expiration time of the capsules.</li>
<li>CCS returns Client a transaction identifier for each capsule.</li>
</ol>
<p><strong>Extensions</strong>
1a. Client uses an organization-specific external configuration service:</p>
<ol>
<li>Client first syncs default capsule expiration time from an organization-specific external service.</li>
<li>External provides a default capsule expiration time.</li>
<li>Client sends a server capsule using the appropriate API service to a CCS using the expiration time from external configuration.</li>
<li>Use case continues from step 2.</li>
</ol>
<p>2a. Server capsule exceeds the allowed length limit:</p>
<ol>
<li>CCS returns Client an error message.</li>
<li>Use case ends.</li>
</ol>
<p>4a. Client did not provide an expiration time:</p>
<ol>
<li>CCS calculates the expiration time based on system configuration.</li>
<li>Use case continues from step 5.</li>
</ol>
<p>4b. The expiration time provided by Client is longer than allowed in the CCS system configuration:</p>
<ol>
<li>CCS returns Client an error message.</li>
<li>Use case ends.</li>
</ol>
<h3 id="uckts02-request-capsule"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.1.2</span> UC.KTS.02 Request Capsule<a class="headerlink" href="#uckts02-request-capsule" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Context of Use</strong></dt>
<dd>CDOC2 Client Application requests a Server Capsule from CDOC2 Capsule Server. Server Capsule contains an encrypted content encryption key, used for decrypting the archive in a CDOC2 container. The Server Capsule is identified by public key in Recipient certificate and the transaction identifier provided by CDOC2 Client Application.</dd>
</dl>
<p><strong>Scope</strong>
CDOC2 Capsule Server (CCS)</p>
<dl>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
</dl>
<p><strong>Preconditions</strong></p>
<ul>
<li>Recipient is authenticated (see UC.KTS.04 Authenticate Recipient).</li>
</ul>
<p><strong>Success guarantees</strong></p>
<ul>
<li>Server Capsule is forwarded to CDOC2 Client Application.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Client requests a Server Capsule using the appropriate API service, providing a transaction identifier as input.</li>
<li>CCS validates the transaction identifier against specification rules.</li>
<li>CCS finds the correct Server Capsule using the transaction identifier and validates that the Recipient public key matches with the one in the Capsule.</li>
<li>CCS sends the Client the Capsule.</li>
</ol>
<p><strong>Extensions</strong>
2a. transaction identifier is too long:</p>
<ol>
<li>CCS returns Client an error message.</li>
<li>Use case ends.</li>
</ol>
<p>3a. Capsule was not found:</p>
<ol>
<li>CCS returns Client an error message.</li>
<li>Use case ends.</li>
</ol>
<p>3b. Recipient public key does not match the one in the Capsule:</p>
<ol>
<li>CCS returns Client an error message.</li>
<li>Use case ends.</li>
</ol>
<h3 id="uckts03-delete-server-capsules"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.1.3</span> UC.KTS.03 Delete Server Capsules<a class="headerlink" href="#uckts03-delete-server-capsules" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Context of Use</strong></dt>
<dd>System timer deletes expired Server Capsules.</dd>
</dl>
<p><strong>Scope</strong>
CDOC2 Capsule Server (CCS)</p>
<dl>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
</dl>
<p><strong>Success guarantees</strong></p>
<ul>
<li>Expired Server Capsules are removed from the storing CCS.</li>
</ul>
<p><strong>Trigger</strong></p>
<ul>
<li>System timer schedules and initiates the deletion of expired Server Capsules.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>CCS identifies expired Server Capsules.</li>
<li>CCS deletes expired Server Capsules.</li>
</ol>
<p><strong>Extensions</strong></p>
<p>1a. No expired Server Capsules found.</p>
<ol>
<li>Use case ends.</li>
</ol>
<h3 id="uckts04-authenticate-recipient"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.1.4</span> UC.KTS.04 Authenticate Recipient<a class="headerlink" href="#uckts04-authenticate-recipient" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Context of Use</strong></dt>
<dd>CDOC2 Client Application (Client) establishes a TLS-connection to CDOC2 Capsule Server and forwards Recipient certificate.</dd>
</dl>
<p><strong>Scope</strong>
CDOC2 Capsule Server (CCS)</p>
<dl>
<dt><strong>Use Case Level</strong></dt>
<dd>Subfunction</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
<dt><strong>Preconditions</strong></dt>
<dd>Client has a long-term access token from CDOC2 authentication server.</dd>
</dl>
<p><strong>Success guarantees</strong></p>
<ul>
<li>TLS-connection is established.</li>
<li>Recipient certificate exists and is received.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Client initiates a TLS-connection and forwards Recipient certificate.</li>
<li>CCS verifies certificate validity using an OCSP service.</li>
<li>CCS establishes the TLS connection.</li>
</ol>
<p><strong>Extensions</strong></p>
<p>2a. Recipient certificate is not valid:</p>
<ol>
<li>CCS replies to the Client with an error message.</li>
<li>Use case ends.</li>
</ol>
<h2 id="use-cases-with-multiple-cdoc2-shares-servers-holding-shares-of-capsules"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.2</span> Use cases with multiple CDOC2 Shares Servers holding shares of capsules<a class="headerlink" href="#use-cases-with-multiple-cdoc2-shares-servers-holding-shares-of-capsules" title="Permanent link">¶</a></h2>
<p>These use cases are useful, when Sender knows that Recipient can use some eID means for authenticating themselves, but cannot use eID means that support encryption/decryption. These allow Sender to divide the key material into Key Shares according to a <a href="https://en.wikipedia.org/wiki/Secret_sharing">secret-sharing scheme</a> and distribute those among multiple independent CSSs . Recipient would need to authenticate to CSS servers and download all the shares in order to reconstruct the KEK from those.</p>
<h3 id="uckts06-forward-capsule-shares"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.2.1</span> UC.KTS.06 Forward Capsule Shares<a class="headerlink" href="#uckts06-forward-capsule-shares" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Context of Use</strong></dt>
<dd>CDOC2 Client Application forwards Key Shares of all Shares Capsules to CDOC2 Shares Servers (CSS). This use case assumes the n-of-n encryption scheme where the number of shares per capsule is equal to the number of receiving CSS servers. All the shares have to be combined in order to construct a capsule that contains a content encryption key (CEK) encrypted for a particular Recipient. Key Shares are saved, and a unique share identifier is created and returned to the CDOC2 Client Application from each CSS.</dd>
</dl>
<p><strong>Scope</strong>
CDOC2 Shares Server (CSS)</p>
<dl>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
</dl>
<p><strong>Success Guarantees</strong></p>
<ul>
<li>Key Shares of all Shares Capsules are saved with Recipient natural person identifier to all receiving CSS servers.</li>
<li>Share identifiers are forwarded to the CDOC2 Client Application.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Client sends Key Shares of each Shares Capsule to appropriate CSS servers using an API service. The shares are matched to CSS servers by server IDs. Client provides a natural person identifier corresponding to the Recipient.</li>
<li>Each CSS validates the Key Shares against specification rules.</li>
<li>Each CSS generates a share identifier.</li>
<li>Each CSS saves the Key Share.</li>
<li>Each CSS returns Client a share identifier for each Key Share.</li>
</ol>
<p><strong>Extensions</strong>
2a. Shares capsule exceeds the allowed length limit:</p>
<ol>
<li>CSS returns Client an error message.</li>
<li>Use case ends.</li>
</ol>
<h3 id="uckts07-request-capsule-shares"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.2.2</span> UC.KTS.07 Request Capsule Shares<a class="headerlink" href="#uckts07-request-capsule-shares" title="Permanent link">¶</a></h3>
<dl>
<dt><strong>Context of Use</strong></dt>
<dd>CDOC2 Client Application requests Key Shares from all CDOC2 Shares Servers. The Key Share is identified by the share identifier provided by CDOC2 Client Application, the CSS server ID and the Recipient identification (ETSI semantics identifier) that can be matched to Recipient public key.</dd>
</dl>
<p><strong>Scope</strong>
CDOC2 Shares Server (CSS)</p>
<dl>
<dt><strong>Use Case Level</strong></dt>
<dd>User goal</dd>
<dt><strong>Primary Actor</strong></dt>
<dd>CDOC2 Client Application (Client)</dd>
</dl>
<p><strong>Success guarantees</strong></p>
<ul>
<li>Recipient is authenticated.</li>
<li>Key Shares from all CDOC2 Shares Servers are forwarded to CDOC2 Client Application.</li>
</ul>
<p><strong>Main Success Scenario</strong></p>
<ol>
<li>Client requests a nonce from each CSS API service, providing the share identifier as input.</li>
<li>Client calculates an authentication hash.</li>
<li>Client asks the Recipient to authenticate.</li>
<li>Recipient signs the authentication token and Client receives Recipient public key that matches the Recipient identification used in the accessed Shares Capsule.</li>
<li>Client constructs server-specific authentication tickets and sends one to each CSS.</li>
<li>Each CSS validates the received authentication ticket, which includes validating the ticket type, nonce, signature, key pair and public keys.</li>
<li>CSS returns the Key Share.</li>
</ol>
<p><strong>Extensions</strong></p>
<p>1a. Capsule share was not found:</p>
<ol>
<li>CSS returns Client an error message.</li>
<li>Use case ends.</li>
</ol>
<p>3a. Client is unable to get the Recipient to sign an authentication hash:</p>
<ol>
<li>Use case ends.</li>
</ol>
<p>6a. Validation by a CSS finds an error:</p>
<ol>
<li>CSS returns Client an error message.</li>
<li>Use case ends.</li>
</ol>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Introduction" class="md-footer__link md-footer__link--prev" href="../..">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Introduction
              </div>
</div>
</a>
<a aria-label="Next: Encryption Schemes" class="md-footer__link md-footer__link--next" href="../../02_protocol_and_cryptography_spec/ch02_encryption_schemes/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Encryption Schemes
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.footer", "navigation.expand", "content.tooltips", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
<script src="../../javascripts/katex.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
</body>
</html>